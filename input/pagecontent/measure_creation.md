<!-- measure_creation.md {% comment %}
*****************************************************************************************
*                            WARNING: DO NOT EDIT THIS FILE                             *
*                                                                                       *
* This file is generated by SUSHI. Any edits you make to this file will be overwritten. *
*                                                                                       *
* To change the contents of this file, edit the original source file at:                *
* ig-data\input\pagecontent\measure_creation.md                                         *
*****************************************************************************************
{% endcomment %} -->

This section of the implementation guide walks through an example for automating computation
of a measure.  Like the phrase book, it is based on the measure derived from the
![CDC Patient Impact and Hospital Capacity module](57.130-covid19-pimhc-blank-p.png)

### Patient Impact Data Elements
This measure first addresses the Impact of COVID-19 on hospital patients, stratifying data by
hospital location (inpatient vs. ED/Overflow), ventilation status, and patient death on the
date of reporting.

There are multiple sets of patients to report upon for this section.

The initial patient population is Patients in the Hospital with Confirmed or Suspected COVID-19.
  1. Live Patients in any location.
     1. The subset of these in an inpatient bed.
        1. The subset of these who are on a ventilator.
        2. The subset of these who acquired COVID-19 14 days or more after admission.
     2. The subset of these in an ED or overflow bed with an admission order (i.e., those who are intended to be an inpatient).
        1. The subset of these who are on a ventilator.
  2. Dead Patients

Patients on a ventilator are of interest, patients not on a ventilator are a stratum that need not be counted because that
number can be determined mathematically from the data already provided.

Each of the values above is essentially counting an event, an admission to a location, or such admission with the use of ventilator equipment, or a death,
but are not reporting cumulative totals. These would then be reported as different cohorts with potientially overlapping values.

Patients who aquired COVID-19 while in the hospital are a separate strata from patients on a ventilator.

The Venn Diagram below illustrates the different subsets of patients in this measure.
![Venn Diagram](venn.png).

To simplify this section, this measure should be divided into at least three separate groups:
1. Deaths in the hospital during the reporting period
2. Patients in the hospital during the reporting period who have suspected or confirmed COVID-19.<br/>
   This last group should be stratified by the product of location and ventilator status.
   1. Inpatient Setting and Non-Ventilated
   2. Inpatient Setting and Ventilated
   3. ED/Overflow Setting and Non-Ventilated
   4. ED/Overflow Setting and Ventilated
3. Patients in the hospital during the reporting period who have acquired suspected or confirmed COVID-19 14 days or more after admission.

For these proposed groupings:
#### Deaths in the Hospital
Deaths in the hospital during the reporting period is half of an [event growth measure](situation_awareness_measures.html#event-growth),
it does not include the cumulative total number of deaths.  There are several good reasons to use an event growth measure in this case:
   1. Loss of a single report does not damage the cumulative total value.  When the next report is sent, a new cumulative total will also
      be sent, allowing the reciever to adjust for the missing data.
   2. Reporting both the incremental, and cumulative total allows the reciever to detect potential reporting errors over time.
   3. Using the Event Growth measure supports data correction over time. During a public health emergency where there are limited resources,
      activities are triaged to protect life first. Death reporting may be delayed for facilities under extreme stress.
   4. Event growth measures support the [BASE Consistency](https://en.wikipedia.org/wiki/Eventual_consistency) model, which means that prior
      reports don't need to be corrected for the reported data to eventually become consistent.

NOTE: When using an event growth measure, it is important to establish a convention for how to accumulate the total.  By convention,
this is based on the date the sender started reporting data (the simplest to implement), but may be altered to be based on reporting as of
a given date or other criteria (more complicated).

#### Suspected or Confirmed COVID-19 Patients Stratified by Location and Ventilator Status
Upon further inspection, this is a [Queue Length](situation_awareness_measures.html#queue-length) measure. It measures patients in the hospital (in
an inpatient setting or overflow area) awaiting completion of treatment. This is especially evidident in the case for patients in an ED/Overflow
area awaiting an inpatient bed, but generally true for all the different strata.

The use of different strata for this measure helps with the prioritization of additional resource assignments to assist facilities in need,
improves accuracy and provides for error detection and resiliency. The count for the overall population of patients with suspected or
confirmed COVID-19 in the hospital) must be equal to the sum counts over each stratum.  This provides for additional opportunity for
error detection by both the sender and the reciever.  It may also help to identify special cases that may not have been included in the
design or logic of the measure or its stratifying criteria.

NOTE: When designing measures for manual implementation, the use of redundant data assigns more work for the users manually collecting and reporting
the data.  When measures are automatically computed, the work is being done by computer systems implementing software algorithms. It is very little
addition work for the software to do some additional arithmetic, but additional value in providing cross-checks on data accuracy for automated
systems.

#### Patients Acquiring COVID-19 14 days or more after Admission
This measure includes criteria that depends on the timing of two different events.  It cannot be easily evaluated via a FHIR Query
because FHIR Queries do not support complex join criteria (e.g., Observation.date - Observation.encounter.date > 14 days).  Such criteria
can be evaluated using FHIRPath [Date/Time Arithmetic](http://hl7.org/fhirpath/#datetime-arithmetic) or
[CQL Date and Time Operators](https://cql.hl7.org/02-authorsguide.html#datetime-operators).
Several measures consider dates and times that have a relative offset to the reporting period, or an event occuring
3. Patients in the hospital during the reporting period who have acquired suspected or confirmed COVID-19 14 days or more after admission.

### Hospital Capacity
The next section of this measure addresses hospital capacity with respect to all beds, inpatient beds, ICU beds, and ventilators. It can be clearly
divided into two groups: those dealing with available beds, and those dealing with available ventilators.
These are all clearly [Capacity and Utilization](situation_awareness_measures.html#capacity-and-utilization) measures.

#### Hospital Beds
The "All Hospital Beds" measurement does not include both "available" and "in use" beds, and so would not normally be considered to be a
capacity measurement, however, it is included with other measures that clearly provide an approximation of the in use and available beds.
The Bed Venn Diagram below illustrates stratification of beds such that all desirable capacities can be determined from the measure.

![Bed Venn Diagram](venn2.png)

#### Ventilators
Finally, a note on the Ventilators measurement. EHR systems may not directly track ventilator devices in the hospital. Ventilator use is indirectly determined in this measure based on the presence of observations that would only be present in the patient chart
when the patient is being ventilated. Direct tracking of ventilator devices and teleemetry is typically the purview of other systems used for asset
management or ICU central monitoring.  The number of ventilator devices is generally known, and does not change frequently, and so implementers may
provide an alternate mechanism (e.g., a defined parameter) to supply this value.  Thus, while this guide provides an expression for identifying
ventilators in this sample measure, more user feedback on how to obtain this value is desired.




